# ✅ 邮件功能部署检查清单

使用此清单确保所有配置步骤都已完成。

---

## 📦 1. 代码更新

- [x] 更新 `api/contact.ts` - SMTP 密码已更新为 `7a7Q33fO5QM3xMfy`
- [x] 更新 `package.json` - 添加 `@types/nodemailer@^6.4.16`
- [x] 邮件模板已配置（管理员通知 + 自动回复）
- [x] 错误处理已完善
- [x] CORS 配置已设置
- [x] 输入验证已实现

---

## 🔧 2. 本地准备

- [ ] 运行 `npm install` 安装新依赖
- [ ] 确认 `nodemailer` 和 `@types/nodemailer` 已安装
- [ ] 检查代码无编译错误
- [ ] （可选）本地测试邮件功能

---

## ☁️ 3. Vercel 环境变量配置

### 必须配置的环境变量

- [ ] **SMTP_USER**
  - 值: `eikoyang@mono-grp.com.cn`
  - 环境: ✅ Production ✅ Preview ✅ Development

- [ ] **SMTP_PASSWORD**
  - 值: `7a7Q33fO5QM3xMfy`
  - 环境: ✅ Production ✅ Preview ✅ Development

- [ ] **RECIPIENT_EMAIL** (可选)
  - 值: `eikoyang@mono-grp.com.cn`
  - 环境: ✅ Production ✅ Preview ✅ Development

### 验证环境变量

- [ ] 在 Vercel Dashboard 确认所有变量已保存
- [ ] 确认变量值没有多余空格
- [ ] 确认已选择正确的环境

---

## 🚀 4. 部署

### 代码提交

- [ ] `git add .`
- [ ] `git commit -m "更新邮件功能配置"`
- [ ] `git push origin main`

### Vercel 部署

- [ ] 确认 Vercel 自动开始部署
- [ ] 等待部署完成（约1-2分钟）
- [ ] 检查部署状态为 "Ready"
- [ ] 没有构建错误

### 或使用 Vercel CLI

- [ ] `vercel --prod`
- [ ] 部署成功

---

## 🧪 5. 功能测试

### 测试方法 1：使用测试脚本

```bash
./test-contact-api.sh https://你的域名.vercel.app/api/contact
```

- [ ] 脚本执行成功
- [ ] HTTP 状态码 200
- [ ] 返回 `{"success": true}`

### 测试方法 2：通过网站界面

1. 访问网站
   - [ ] 网站正常加载
   - [ ] 滚动到联系部分

2. 填写表单
   - [ ] 姓名: 测试用户
   - [ ] 邮箱: 你的测试邮箱
   - [ ] 公司: 测试公司
   - [ ] 消息: 这是测试消息

3. 提交表单
   - [ ] 点击"送信"按钮
   - [ ] 显示"发送中..."
   - [ ] 显示成功提示
   - [ ] 表单字段清空

### 测试方法 3：使用 curl

```bash
curl -X POST https://你的域名.vercel.app/api/contact \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试用户",
    "email": "test@example.com",
    "company": "测试公司",
    "message": "这是测试消息"
  }'
```

- [ ] 返回成功响应
- [ ] JSON 格式正确

---

## 📧 6. 邮件验证

### 管理员邮箱检查

检查 `eikoyang@mono-grp.com.cn` 邮箱：

- [ ] 收到新邮件通知
- [ ] 主题: "新的联系表单 - 测试用户"
- [ ] 邮件格式美观（HTML）
- [ ] 包含客户信息：
  - [ ] 姓名
  - [ ] 邮箱
  - [ ] 公司
  - [ ] 消息内容
- [ ] 可以直接点击"回复"

### 客户自动回复检查

检查你的测试邮箱：

- [ ] 收到自动回复邮件
- [ ] 主题: "感谢您的咨询 - 上海英物国際貿易"
- [ ] 邮件格式美观（HTML）
- [ ] 包含：
  - [ ] 感谢信息
  - [ ] 提交内容回显
  - [ ] 公司联系方式
  - [ ] 公司地址、电话、邮箱
- [ ] 邮件没有进垃圾邮件文件夹

---

## 🔍 7. 日志检查

### Vercel 函数日志

1. 进入 Vercel Dashboard
   - [ ] 登录 Vercel
   - [ ] 选择项目
   - [ ] 进入 Deployments

2. 查看函数日志
   - [ ] 选择最新部署
   - [ ] 点击 "Functions" 标签
   - [ ] 找到 `api/contact`
   - [ ] 查看日志输出

3. 确认日志内容
   - [ ] 显示 "Received contact form"
   - [ ] 显示 SMTP 连接成功
   - [ ] 显示 "Admin email sent"
   - [ ] 显示 "User email sent"
   - [ ] 没有错误信息

---

## 🌐 8. 多语言测试

### 中文界面测试

- [ ] 切换到中文
- [ ] 表单标签显示中文
- [ ] 提交按钮显示"发送"
- [ ] 成功提示显示中文
- [ ] 错误提示显示中文

### 日文界面测试

- [ ] 切换到日文
- [ ] 表单标签显示日文
- [ ] 提交按钮显示"送信する"
- [ ] 成功提示显示日文
- [ ] 错误提示显示日文

---

## 🔐 9. 安全检查

### 输入验证

- [ ] 空表单提交被拒绝
- [ ] 无效邮箱格式被拒绝
- [ ] XSS 尝试被转义
- [ ] CORS 正确配置

### 环境变量安全

- [ ] 密码存储在 Vercel 环境变量中
- [ ] 密码不在代码中硬编码
- [ ] `.env` 文件在 `.gitignore` 中
- [ ] 不暴露 SMTP 密码

---

## 📱 10. 响应式测试

### 桌面端

- [ ] 表单布局正常
- [ ] 按钮可点击
- [ ] 提示正常显示

### 移动端

- [ ] 表单适配移动屏幕
- [ ] 输入框大小合适
- [ ] 按钮易于点击
- [ ] 提示正常显示

---

## 🎯 11. 性能检查

### 加载性能

- [ ] 页面加载速度快
- [ ] 表单提交响应快（<3秒）
- [ ] 没有明显卡顿

### 函数性能

- [ ] Vercel 函数执行时间 <10秒
- [ ] 没有超时错误
- [ ] 内存使用正常

---

## 📊 12. 监控设置

### 定期检查

- [ ] 设置提醒：每周测试一次
- [ ] 检查垃圾邮件文件夹
- [ ] 查看 Vercel 使用量
- [ ] 监控错误率

### 文档更新

- [ ] 阅读 `CONTACT_EMAIL_SETUP.md`
- [ ] 阅读 `VERCEL_ENV_SETUP.md`
- [ ] 阅读 `QUICK_DEPLOY_EMAIL.md`
- [ ] 保存重要文档链接

---

## 🆘 13. 故障排查准备

### 如果测试失败

- [ ] 查看 Vercel 函数日志
- [ ] 确认环境变量正确
- [ ] 检查 SMTP 密码是否正确
- [ ] 尝试重新部署
- [ ] 查看浏览器控制台错误
- [ ] 参考 `CONTACT_EMAIL_SETUP.md` 故障排查部分

### 常见问题解决方案

问题 | 解决方案
----|--------
提交后无响应 | 检查浏览器控制台、Vercel 日志
SMTP 连接失败 | 验证环境变量、检查密码
收不到邮件 | 检查垃圾邮件、确认邮箱地址
环境变量不生效 | 重新部署项目
超时错误 | 检查 SMTP 服务器连接

---

## ✅ 最终确认

全部完成后，确认以下所有项：

- [ ] ✅ 代码已更新并部署
- [ ] ✅ Vercel 环境变量已配置
- [ ] ✅ 测试表单提交成功
- [ ] ✅ 管理员收到通知邮件
- [ ] ✅ 客户收到自动回复
- [ ] ✅ 日志显示无错误
- [ ] ✅ 多语言功能正常
- [ ] ✅ 移动端适配良好
- [ ] ✅ 已阅读相关文档

---

## 🎉 部署成功！

恭喜！你的联系表单邮件功能已完全配置并可用。

### 后续维护

1. **定期测试**（建议每周一次）
2. **监控邮件送达率**
3. **更新 SMTP 密码**（建议每3个月）
4. **检查 Vercel 使用量**
5. **关注客户反馈**

### 技术支持

- 📖 详细文档：`CONTACT_EMAIL_SETUP.md`
- 🔧 配置指南：`VERCEL_ENV_SETUP.md`
- 🚀 快速部署：`QUICK_DEPLOY_EMAIL.md`
- 🧪 测试脚本：`test-contact-api.sh`

---

**完成日期**: __________  
**测试人员**: __________  
**部署环境**: Production  
**项目版本**: v1.0

---

**祝贺您完成部署！** 🎊

