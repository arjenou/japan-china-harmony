# Yingwu 商品管理后台 - 使用说明

## 一、快速开始（5分钟）

### 1. 安装 Wrangler

```bash
npm install -g wrangler
wrangler login
```

### 2. 创建数据库和存储

```bash
cd workers
npm install

# 创建 D1 数据库
wrangler d1 create yingwu_products

# 记下 database_id，更新 wrangler.toml 中的 database_id

# 创建 R2 存储桶
wrangler r2 bucket create yingwu-images
wrangler r2 bucket create yingwu-images-preview

# 初始化数据库
npm run db:init
```

### 3. 部署

```bash
npm run deploy
```

记下部署后的 URL，例如：`https://yingwu-admin.xxx.workers.dev`

### 4. 配置前端

编辑 `src/pages/Admin.tsx`，更新 API 地址：

```typescript
const API_BASE_URL = 'https://你的worker地址.workers.dev';
```

### 5. 访问管理界面

```bash
# 启动前端
cd ..
npm run dev
```

访问 `http://localhost:5173/admin` 开始管理商品！

## 二、功能说明

### 商品管理

- ✅ 添加商品：点击"添加商品"按钮
- ✅ 编辑商品：点击商品卡片上的"编辑"按钮
- ✅ 删除商品：点击"删除"按钮
- ✅ 按分类筛选：使用顶部的分类下拉菜单

### 图片管理

- 支持上传多张图片
- 第一张图片自动设为主图
- 编辑时可以添加新图片
- 可以删除单张图片

### 商品分类

系统支持 8 个分类：

1. 瑜伽服
2. 瑜伽器具
3. 运动休闲类
4. 功能性服装
5. 包类
6. 軍手と手袋（手套类）
7. 雑貨類（杂货类）
8. アニメ類（动漫类）

## 三、导入现有数据

如果你已有商品数据，可以批量导入：

### 方式 1：使用脚本（推荐）

```bash
cd workers

# 1. 上传图片到 R2
npm install --save-dev glob
node scripts/upload-images.js

# 2. 生成并导入产品数据
node scripts/import-products.js
wrangler d1 execute yingwu_products --file=./import-data.sql --remote
```

### 方式 2：手动添加

通过管理界面逐个添加商品（适合少量商品）。

## 四、日常操作

### 查看日志

```bash
cd workers
npm run tail
```

### 备份数据库

```bash
wrangler d1 export yingwu_products --output=backup.sql
```

### 恢复数据库

```bash
wrangler d1 execute yingwu_products --file=backup.sql --remote
```

### 查看商品列表

```bash
wrangler d1 execute yingwu_products --command="SELECT * FROM products" --remote
```

## 五、常见问题

### Q1: 图片上传失败？

**检查：**
- R2 存储桶是否已创建
- 图片大小是否超过 5MB
- 网络连接是否正常

### Q2: 管理界面打不开？

**检查：**
- Worker 是否已部署
- API 地址是否配置正确
- 浏览器控制台是否有错误

### Q3: 图片无法显示？

**检查：**
- 图片是否已上传到 R2
- 图片 URL 是否正确
- Worker 的图片接口是否正常

### Q4: 数据库操作失败？

**检查：**
- 数据库是否已初始化
- 表结构是否正确
- database_id 是否配置正确

## 六、生产环境部署

### 1. 配置自定义域名

在 Cloudflare Dashboard 中：
- 进入 Workers & Pages
- 选择你的 Worker
- 点击 Triggers → Add Custom Domain
- 输入域名（如 api.your-domain.com）

### 2. 部署前端

推荐使用 Cloudflare Pages：

```bash
# 推送到 GitHub
git add .
git commit -m "Deploy"
git push

# 在 Cloudflare Dashboard 中连接 GitHub 仓库
# 构建设置：
#   - Framework: Vite
#   - Build command: npm run build
#   - Build output: dist
```

### 3. 更新 API 地址

将 `src/pages/Admin.tsx` 中的 API 地址改为生产环境地址。

### 4. 添加身份验证（重要！）

在 `src/pages/Admin.tsx` 中添加密码保护（见 DEPLOYMENT_GUIDE.md）。

## 七、成本说明

### Cloudflare 免费套餐

- Workers: 每天 10 万次请求
- D1: 每天 5GB 读取
- R2: 10GB 存储
- Pages: 无限流量

**结论：中小型网站完全免费！**

### 付费套餐（如需升级）

- Workers Paid: $5/月（1000 万次请求）
- R2: $0.015/GB/月
- D1: $0.75/百万行读取

## 八、安全建议

⚠️ **生产环境必做：**

1. 为管理界面添加密码保护
2. 配置 CORS 只允许你的域名
3. 定期备份数据库
4. 使用 HTTPS（Cloudflare 自动提供）
5. 设置速率限制

## 九、技术支持

### 文档

- 详细 API 文档：`workers/README.md`
- 快速开始：`workers/QUICK_START.md`
- 部署指南：`DEPLOYMENT_GUIDE.md`
- 脚本说明：`workers/scripts/README.md`

### 有用的命令

```bash
# 查看 Worker 状态
wrangler whoami

# 列出所有 Workers
wrangler deployments list

# 查看数据库列表
wrangler d1 list

# 查看 R2 存储桶
wrangler r2 bucket list
```

### 获取帮助

- Cloudflare Workers 文档：https://developers.cloudflare.com/workers/
- Cloudflare 社区：https://community.cloudflare.com/
- GitHub Issues（如果是开源项目）

## 十、下一步

- [ ] 添加商品搜索功能
- [ ] 实现批量操作
- [ ] 添加数据统计
- [ ] 优化图片加载
- [ ] 添加多用户管理

---

**祝使用愉快！** 🎉

如有问题，请查看详细文档或联系技术支持。

